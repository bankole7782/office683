<!doctype html>
<html>
<head>
  <title>All Documents</title>
  <link rel="shorcut icon" type="image/png" href="/gs/office683_logo.png" />
  <script src="/gs/jquery-3.6.0.min.js"></script>
  <script>
    $(document).ready(function() {
      const ndDialog = document.getElementById('new_doc_dialog');
      const deleteDocDialog = document.getElementById("delete_doc_dialog");

      $("#new_doc_btn").click(function(e) {
        ndDialog.showModal();
      });

      $(".folder_href").click(function(e) {
        e.preventDefault();
        var folderName = $(e.target).data("folder")

        $(".a_doc").each(function(i, el) {
          var docFolderName = $(el).data("folder")
          if (docFolderName == folderName) {
            $(el).show();
          } else {
            $(el).hide();
          }
        });

        $(".folder_href").removeClass("active")
        $(e.target).addClass("active");
      });

      $(".delete_doc_btn").click(function(e) {
        e.preventDefault();

        var docId = $(e.target).data("docid")
        var docTitle = $(e.target).data("doctitle")

        msg = "Confirm delete of Document: " + docTitle
        $("#delete_msg").text(msg);
        $("#docid_span").text(docId);

        deleteDocDialog.showModal();
      });

      $("#cancel_doc_dialog").click(function(e) {
        deleteDocDialog.close();
      });

      $("#true_delete_btn").click(function(e) {
        e.preventDefault();

        $.ajax({
          type: "POST",
          url: "/delete_doc_u89xe/" + $("#docid_span").text(),
        }).done(function(o) {
          location.reload()
        });
      })
    })
  </script>
  <style>
    @font-face {
      font-family: "Quicksand";
      src: url("/gs/Quicksand-Regular.ttf");
    }
    body {
      font-family: Quicksand;
      width: 960px;
      margin: 0 auto;
    }
    input, button {
      font-family: Quicksand;
    }
    input[type=text] {
      width: 300px;
    }
    form div {
      margin-bottom: 10px;
    }
    #folders_pane, #docs_pane {
      float: left;
    }
    #folders_pane {
      width: 200px;
    }
    #docs_pane {
      width: 400px;
      margin-left: 20px;
    }
    h1, h2, h3, h4, p {
      margin: 5px 0px;
    }
    #folders_pane a, #folders_pane a:visited {
      display: block;
      padding-left: 10px;
      padding-bottom: 10px;
      text-decoration: none;
      color: blue;
    }
    #folders_pane a.active {
      background-color: #679567;
      color: #fff;
    }
    .a_doc {
      display: none;
      margin-bottom: 20px;
    }
    .a_doc.active {
      display:block;
    }
    #header {
      margin: 0 auto;
    }
    #header * {
      margin-left: 20px;
    }
    .loud {
      font-size: 1.5em;
    }
    #all_docs {
      margin-top: 20px;
    }
  </style>

</head>
<body>
  <div id="header">
    <span class="loud">All Documents</span>
    <a href="/">Office683 Home</a>
    <button id="new_doc_btn">New Document</button>
    <a href="/docs_images/">Images for Documents</a>
  </div>

  <div id="all_docs">
    <div id="folders_pane">
      <h2>Folder Name</h2>
      {{range $k, $v := .Folders}}
        {{ if eq $k 0}}
          <a href="#" class="folder_href active" data-folder="{{.}}">{{.}}</a>
        {{ else}}
          <a href="#" class="folder_href" data-folder="{{.}}">{{.}}</a>
        {{end}}
      {{end}}
    </div>
    <div id="docs_pane">
      <h2>Documents</h2>
      {{range $k, $fname := .Folders}}
        {{$docs := index $.FoldersToDocsMap $fname}}
        {{range $docs}}
          {{if eq $k 0}}
          <div class="a_doc active" data-folder="{{$fname}}">
          {{else}}
          <div class="a_doc" data-folder="{{$fname}}">
          {{end}}
            <p>Title : <b>{{.doc_title}}</b></p>
            <p>Last Update date: <b>{{.updated}}</b></p>
            <p>Doc Size: <b>{{.doc_size}}</b></p>
            <a href="/update_doc/{{.id}}">Update Doc</a>&nbsp;&nbsp;
            <a href="/doc/{{.id}}">View Rendered Doc</a>&nbsp;&nbsp;
            <a href="#" class="delete_doc_btn" data-docid="{{.id}}" data-doctitle="{{.doc_title}}">Delete Document</a>
          </div>
        {{end}}
      {{end}}
  </div>
  <dialog id="new_doc_dialog">
    <h3>New Document Dialog</h3>
    <form method="post" action="/new_doc">
      <div>
        <label>Enter Folder Name</label><br>
        <input type="text" name="folder" required />
      </div>
      <div>
        <label>Enter Document Title</label><br>
        <input type="text" name="doc_title" required />
      </div>
      <div>
        <input type="submit" value="Create" />
      </div>
      <p class="help">Press <b>ESC</b> to dismiss</p>
    </form>
  </dialog>

  <dialog id="delete_doc_dialog">
    <p id="delete_msg"></p>
    <span id="docid_span" style="display:none;"></span>
    <button id="true_delete_btn">Delete</button>
    &nbsp;&nbsp;&nbsp;
    <button id="cancel_doc_dialog">Cancel</button>
  </dialog>
</body>
</html>
