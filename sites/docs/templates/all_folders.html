<!doctype html>
<html>
<head>
  <title>All Documents</title>
  <link rel="shorcut icon" type="image/png" href="/gs/office683_logo.png" />
  <script src="/gs/jquery-3.6.0.min.js"></script>
  <script src="/gs/autosize.min.js"></script>

  <script>
    $(document).ready(function() {
      autosize($("textarea"));

      const ndDialog = document.getElementById('new_doc_dialog');
      const nfDialog = document.getElementById('new_folder_dialog');
      const deleteDocDialog = document.getElementById("delete_doc_dialog");

      $("#new_doc_btn").click(function(e) {
        ndDialog.showModal();
      });

      $("#new_folder_btn").click(function(e) {
        nfDialog.showModal();
      })

      $(".folder_href").click(function(e) {
        e.preventDefault();
        var folderName = $(e.target).data("folder")

        $(".a_doc").each(function(i, el) {
          var docFolderName = $(el).data("folder")
          if (docFolderName == folderName) {
            $(el).show();
          } else {
            $(el).hide();
          }
        });

        $(".folder_href").removeClass("active")
        $(e.target).addClass("active");
      });

      $(".delete_doc_btn").click(function(e) {
        e.preventDefault();

        var docId = $(e.target).data("docid")
        var docTitle = $(e.target).data("doctitle")

        msg = "Confirm delete of Document: " + docTitle
        $("#delete_msg").text(msg);
        $("#docid_span").text(docId);

        deleteDocDialog.showModal();
      });

      $("#cancel_doc_dialog").click(function(e) {
        deleteDocDialog.close();
      });

      $("#true_delete_btn").click(function(e) {
        e.preventDefault();

        $.ajax({
          type: "POST",
          url: "/delete_doc_u89xe/" + $("#docid_span").text(),
        }).done(function(o) {
          location.reload()
        });
      })
    })
  </script>
  <style>
    @font-face {
      font-family: "Quicksand";
      src: url("/gs/Quicksand-Regular.ttf");
    }
    body {
      font-family: Quicksand;
      width: 960px;
      margin: 0 auto;
    }
    input, button {
      font-family: Quicksand;
    }
    input, textarea {
      width: 300px;
    }
    input[type=submit], input[type=checkbox] {
      width: auto;
    }
    form div {
      margin-bottom: 10px;
    }
    #folders_pane, #docs_pane {
      float: left;
    }
    #folders_pane {
      width: 200px;
    }
    #docs_pane {
      width: 400px;
      margin-left: 20px;
    }
    h1, h2, h3, h4, p {
      margin: 5px 0px;
    }
    #folders_pane a, #folders_pane a:visited {
      display: block;
      padding-left: 10px;
      padding-bottom: 10px;
      text-decoration: none;
      color: blue;
    }
    #folders_pane a.active {
      background-color: #679567;
      color: #fff;
    }
    .a_doc {
      display: none;
      margin-bottom: 20px;
    }
    .a_doc.active {
      display:block;
    }
    #header {
      margin: 0 auto;
    }
    #header * {
      margin-left: 20px;
    }
    .loud {
      font-size: 1.5em;
    }
    #all_docs {
      margin-top: 20px;
    }
    .a_folder {
      width: 200px;
      float: left;
      margin-right: 20px;
    }
  </style>

</head>
<body>
  <div id="header">
    <span class="loud">All Documents</span>
    <a href="/programs">Programs</a>
    <button id="new_folder_btn">New Folder</button>
    <button id="new_doc_btn">New Document</button>
    <a href="/docs_images/">Images for Documents</a>
  </div>

  <div id="all_docs">
    {{if .HaveTeams}}
      {{range $.YourTeams}}
        <h3>{{.team_name}}'s Folders</h3>
        {{$folders := index $.TeamsToFolders .team_name}}
        {{range $folders}}
          <div class="a_folder">
            <a href="/docs/{{.id}}">{{.folder_name}}</a>
          </div>
        {{end}}
      {{end}}
    {{else}}
      <p>You can't view any folder because you are not included in any team. Please contact the admin</p>
    {{end}}
  </div>

  <dialog id="new_doc_dialog">
    <h3>New Document Dialog</h3>
    <form method="post" action="/new_doc">
      <div>
        <label>Select Team/ Folder (Team Members would be given Edit Access)</label><br>
        <select name="team_folder" required>
          {{range $.Folders}}
            <option value="{{.teamid}}-{{.folderid}}">{{.team_name}}/{{.folder_name}}</option>
          {{end}}
      </select>
      </div>
      <div>
        <label>Enter Document Title</label><br>
        <input type="text" name="doc_title" required />
      </div>
      <div>
        <input type="submit" value="Create" />
      </div>
      <p class="help">Press <b>ESC</b> to dismiss</p>
    </form>
  </dialog>

  <dialog id="new_folder_dialog">
    <h3>New Folder Dialog</h3>
    <form method="post" action="/new_folder">
      <div>
        <label>Select Team (Team Members would be given Edit Access)</label><br>
        <select name="teamid" required>
          {{range $.YourTeams}}
            <option value="{{.teamid}}">{{.team_name}}</option>
          {{end}}
      </select>
      </div>
      <div>
        <label>Enter Folder Name</label><br>
        <input type="text" name="folder_name" required />
      </div>
      <div>
        <label>Optional Description</label><br>
        <textarea name="desc"></textarea>
      </div>
      <div>
        <input type="submit" value="Create" />
      </div>
      <p class="help">Press <b>ESC</b> to dismiss</p>
    </form>
  </dialog>

</body>
</html>
